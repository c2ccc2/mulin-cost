import{l as V,d as A}from"./projectUser-D62y_OJi.js";import{_ as M,e as L,r as b,w as W,B as E,f as r,c as v,o as u,h as t,k as R,l as q,j as l,i as _,m as k,Y as x,t as h,Z as z,p as g}from"./index-DOTrAPYh.js";import D from"./addMember-DmIwjaK0.js";import"./user-CyO_SREy.js";const Y={class:"main"},Z={class:"text item"},F={class:"userImg"},G={class:"demo-image"},H={key:0,class:"block"},J={key:1,class:"block"},K={__name:"member",props:{projectId:{type:String,required:!0}},emits:["success"],setup(w,{emit:O}){const{proxy:a}=L(),j="/prod-api",i=w,f=b([]),y=b(0),n=b(!1);W(()=>i.projectId,e=>{e&&p()});const C=e=>e?e.startsWith("http://")||e.startsWith("https://")?e:e.startsWith("/")?j+e:j+"/"+e:x,p=async()=>{if(i.projectId)try{const e=await V(i.projectId);e.code===200&&(f.value=e.rows||e.data||[],y.value=e.total||f.value.length||0)}catch(e){console.error("获取项目成员列表失败:",e)}},$=()=>{n.value=!0},U=()=>{n.value=!1,p()},B=async(e,o)=>{try{console.log("删除成员:",o);let c={projectId:i.projectId,userIds:o.userId};const m=await A(c);m.code===200?(console.log("删除成功"),a&&a.$modal?a.$modal.msgSuccess("移除成功"):console.log("proxy 或 $modal 不存在"),p()):a&&a.$modal&&a.$modal.msgError(m.msg||"移除失败")}catch(c){console.error("删除成员失败:",c)}};return E(()=>{i.projectId&&p()}),(e,o)=>{const c=r("el-button"),m=r("el-descriptions-item"),N=r("el-descriptions"),d=r("el-table-column"),I=r("el-image"),S=r("el-table"),T=r("el-card");return u(),v("div",Y,[t(T,{class:"box-card cardtwo"},{header:l(()=>[t(N,{title:"项目成员信息"},{extra:l(()=>[t(c,{type:"primary",plain:"",onClick:$},{default:l(()=>o[2]||(o[2]=[g(" 添加人员 ")])),_:1,__:[2]})]),default:l(()=>[t(m,{label:"项目成员"},{default:l(()=>[g(h(y.value)+"人 ",1)]),_:1})]),_:1})]),default:l(()=>[_("div",Z,[t(S,{data:f.value,style:{width:"100%"}},{default:l(()=>[t(d,{prop:"userId",label:"用户Id",align:"center",width:"80"}),t(d,{prop:"avatar",label:"头像",width:"119",align:"center"},{default:l(s=>[_("div",F,[_("div",G,[s.row.avatar&&s.row.avatar!=""?(u(),v("div",H,[t(I,{src:C(s.row.avatar)},null,8,["src"])])):(u(),v("div",J,[t(I,{src:k(x)},null,8,["src"])]))])])]),_:1}),t(d,{prop:"nickName",label:"姓名",align:"center"}),t(d,{prop:"joinTime",label:"加入时间",align:"center"},{default:l(s=>[_("span",null,h(k(z)(s.row.joinTime)),1)]),_:1}),t(d,{fixed:"right",label:"操作",width:"120",align:"center"},{default:l(s=>[t(c,{onClick:Q=>B(s.$index,s.row),type:"danger",link:"",size:"small"},{default:l(()=>o[3]||(o[3]=[g(" 移除 ")])),_:2,__:[3]},1032,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1}),n.value?(u(),R(D,{key:0,visible:n.value,"onUpdate:visible":o[0]||(o[0]=s=>n.value=s),"project-id":w.projectId,onSuccess:U,onClose:o[1]||(o[1]=s=>n.value=!1)},null,8,["visible","project-id"])):q("",!0)])}}},oe=M(K,[["__scopeId","data-v-8bce5c09"]]);export{oe as default};
