import{i as P,u as A}from"./day-BW9qJLif.js";import{b as J}from"./project-CvO5xYQd.js";import{i as q}from"./other-DCksgyzN.js";import{l as G}from"./projectHour-DaHsWXCm.js";import{_ as K,e as Q,r,w as W,f as p,c as C,o as V,h as a,j as n,i as t,F as X,C as Y,t as I,k as Z,l as ee,p as U}from"./index-DOTrAPYh.js";const oe={class:"main"},le={class:"project-header"},te={class:"projectLabel"},ae={style:{display:"flex","justify-content":"flex-start","align-items":"center"}},se={class:"project-header"},re={style:{display:"flex","justify-content":"flex-start","align-items":"center"}},ue={class:"myfoot"},ne={style:{float:"right","text-align":"right"}},ie={class:"tips",style:{"margin-right":"10px"}},de={class:"footer-btn"},me={__name:"editHour",emits:["commit"],setup(ce,{expose:E,emit:F}){const{proxy:i}=Q(),R=F,y=r(!1),j=r(void 0),x=r(""),v=r({}),u=r([]),s=r({hour:0,daily:""}),w=r(0),f=r(""),d=r(!1),H=r(!0),B=r({});W([u,s],()=>{N()},{deep:!0});const N=()=>{let o=0;u.value.forEach(e=>{e.hour&&!isNaN(e.hour)&&(o+=parseFloat(e.hour))}),s.value.hour&&!isNaN(s.value.hour)&&(o+=parseFloat(s.value.hour)),w.value=o.toFixed(2),o>24?(f.value="工时超过24小时，无法提交",d.value=!0):o>8?(f.value="注意：工时超过8小时，请确认填写无误",d.value=!1):o===0?(f.value="请填写工时",d.value=!0):(f.value="",d.value=!1)},M=async()=>{try{const o=await J();o.code===200&&(u.value=o.data.map(e=>({...e,hour:0,daily:"",isArchive:e.status!=="进行中"})))}catch(o){console.error("获取项目列表失败:",o)}},S=async o=>{if(!o){i.$modal.msgError("参数错误");return}j.value=o,y.value=!0;try{const e=await P(o);e.code===200&&(x.value=e.data.fillDate),await M();const m=await G(o);if(m.code===200){const _=m.data||[];u.value=u.value.map(g=>{const c=_.find(k=>k.projectId===g.projectId);return{...g,hour:c?c.hour:0,daily:c?c.daily:""}})}const h=await q(o);h.code===200?s.value=h.data||{hour:0,daily:""}:s.value={hour:0,daily:""},D(),N()}catch(e){console.error("获取工时详情失败:",e),i.$modal.msgError("获取工时详情失败")}},T=o=>{u.value=u.value.filter(e=>e.projectId!==o),i.$modal.msgSuccess("项目已移除")},z=()=>{s.value={hour:0,daily:""},H.value=!1,i.$modal.msgSuccess("普通工时已移除")},D=()=>{H.value=!0},$=()=>{u.value=[],s.value={hour:0,daily:""},f.value="",w.value=0,d.value=!1,j.value=void 0,x.value="",y.value=!1},O=async()=>{if(d.value){i.$modal.msgError("请检查工时填写是否正确");return}try{v.value.id=j.value,v.value.date=x.value,v.value.otherHour=s.value,v.value.projectHours=u.value;const o=await A(v.value);o.code===200?(i.$modal.msgSuccess("工时更新成功"),y.value=!1,R("commit")):i.$modal.msgError(o.msg||"更新失败")}catch(o){i.$modal.msgError("更新失败: "+o.message)}};return E({show:S}),(o,e)=>{const m=p("el-button"),h=p("el-input-number"),_=p("el-input"),g=p("el-card"),c=p("el-form-item"),k=p("el-form"),L=p("el-dialog");return V(),C("div",oe,[a(L,{title:"编辑工时:"+x.value,modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=l=>y.value=l),style:{width:"35%",margin:"0 auto"},"before-close":$,"close-on-click-modal":!1},{default:n(()=>[a(k,{model:v.value,"status-icon":"",rules:B.value,style:{"max-height":"75vh","overflow-y":"scroll"}},{default:n(()=>[a(c,{label:"项目工时","label-position":"top"},{default:n(()=>[(V(!0),C(X,null,Y(u.value,l=>(V(),C("div",{key:l.projectId,class:"project-item"},[a(g,{class:"box-card",shadow:"never",style:{width:"100%","margin-bottom":"20px"}},{header:n(()=>[t("div",le,[t("span",te," #"+I(l.projectId)+" "+I(l.projectName),1),a(m,{type:"danger",icon:"Delete",circle:"",size:"small",onClick:b=>T(l.projectId),title:"移除项目"},null,8,["onClick"])])]),default:n(()=>[t("div",ae,[a(h,{modelValue:l.hour,"onUpdate:modelValue":b=>l.hour=b,modelModifiers:{number:!0},type:"number",max:24,min:0,maxlength:"2",autocomplete:"off",style:{width:"40%"},precision:2},null,8,["modelValue","onUpdate:modelValue"]),e[4]||(e[4]=t("span",{style:{"margin-left":"10px"}},"小时",-1))]),e[5]||(e[5]=t("hr",null,null,-1)),a(_,{style:{"margin-top":"5px"},modelValue:l.daily,"onUpdate:modelValue":b=>l.daily=b,type:"textarea",maxlength:"200",autosize:{minRows:2,maxRows:6},"show-word-limit":"",placeholder:"请填写日志"},null,8,["modelValue","onUpdate:modelValue"])]),_:2,__:[5]},1024)]))),128))]),_:1}),a(c,{label:"普通工时","label-position":"top"},{default:n(()=>[H.value?(V(),Z(g,{key:0,class:"box-card",shadow:"never",style:{width:"100%"}},{header:n(()=>[t("div",se,[e[6]||(e[6]=t("span",{class:"projectLabel"},"其他工时",-1)),a(m,{type:"danger",icon:"Delete",circle:"",size:"small",onClick:z,title:"移除普通工时"})])]),default:n(()=>[t("div",re,[a(h,{modelValue:s.value.hour,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value.hour=l),modelModifiers:{number:!0},type:"number",max:24,min:0,maxlength:"2",autocomplete:"off",style:{width:"40%"},precision:2},null,8,["modelValue"]),e[7]||(e[7]=t("span",{style:{"margin-left":"10px"}},"小时",-1))]),e[8]||(e[8]=t("hr",null,null,-1)),a(_,{style:{"margin-top":"5px"},modelValue:s.value.daily,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.daily=l),type:"textarea",maxlength:"200",autosize:{minRows:2,maxRows:6},"show-word-limit":"",placeholder:"请填写日志"},null,8,["modelValue"])]),_:1,__:[8]})):ee("",!0)]),_:1})]),_:1},8,["model","rules"]),t("div",ue,[t("div",ne,[t("span",ie,I(f.value),1),a(_,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=l=>w.value=l),modelModifiers:{number:!0},max:24,autocomplete:"off",disabled:!0,style:{width:"20%"}},null,8,["modelValue"]),e[11]||(e[11]=t("span",{style:{margin:"0 10px"}},"小时",-1)),t("div",de,[a(m,{onClick:$,style:{width:"100px"}},{default:n(()=>e[9]||(e[9]=[U(" 取 消 ")])),_:1,__:[9]}),a(m,{disabled:d.value,type:"primary",onClick:O,style:{width:"100px"}},{default:n(()=>e[10]||(e[10]=[U(" 提交 ")])),_:1,__:[10]},8,["disabled"])])])])]),_:1},8,["title","modelValue"])])}}},_e=K(me,[["__scopeId","data-v-196ec38f"]]);export{_e as default};
