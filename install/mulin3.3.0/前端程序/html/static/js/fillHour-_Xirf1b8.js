import{c as S}from"./day-BW9qJLif.js";import{b as z}from"./project-CvO5xYQd.js";import{_ as A,e as L,r,w as D,f as m,c as x,o as g,h as t,j as u,i as a,F as J,C as P,t as b,p as N}from"./index-DOTrAPYh.js";const q={class:"main"},G={class:"projectLabel"},K={style:{display:"flex","justify-content":"flex-start","align-items":"center"}},O={style:{display:"flex","justify-content":"flex-start","align-items":"center"}},Q={class:"myfoot"},W={style:{float:"right","text-align":"right"}},X={class:"tips",style:{"margin-right":"10px"}},Y={align:"center",class:"footer-btn"},Z={__name:"fillHour",emits:["commit"],setup(ee,{expose:U,emit:C}){const{proxy:f}=L(),k=C,p=r(!1),y=r(""),c=r({}),i=r([]),s=r({hour:0,daily:""}),v=r(0),d=r(""),n=r(!1),E=r({});D([i,s],()=>{M()},{deep:!0});const M=()=>{let l=0;i.value.forEach(e=>{e.hour&&!isNaN(e.hour)&&(l+=parseFloat(e.hour))}),s.value.hour&&!isNaN(s.value.hour)&&(l+=parseFloat(s.value.hour)),v.value=l.toFixed(2),l>24?(d.value="工时超过24小时，无法提交",n.value=!0):l>8?(d.value="注意：工时超过8小时，请确认填写无误",n.value=!1):l===0?(d.value="请填写工时",n.value=!0):(d.value="",n.value=!1)},T=async()=>{try{const l=await z();l.code===200&&(i.value=l.data.map(e=>({...e,hour:0,daily:"",isArchive:e.status!=="进行中"})))}catch(l){console.error("获取项目列表失败:",l)}},I=l=>{console.log("显示对话框:",l),y.value=l.date,i.value=[],s.value={hour:0,daily:""},p.value=!0,T(),v.value=0,d.value="",n.value=!1},w=()=>{i.value=[],s.value={hour:0,daily:""},d.value="",v.value=0,n.value=!1,p.value=!1},R=async()=>{if(n.value){f.$modal.msgError("请检查工时填写是否正确");return}try{c.value.date=y.value,c.value.otherHour=s.value,c.value.projectHours=i.value;const l=await S(c.value);l.code===200?(f.$modal.msgSuccess("工时提交成功"),p.value=!1,k("commit")):f.$modal.msgError(l.msg||"提交失败")}catch(l){f.$modal.msgError("提交失败: "+l.message)}};return U({show:I}),(l,e)=>{const V=m("el-input-number"),_=m("el-input"),j=m("el-card"),F=m("el-form-item"),$=m("el-form"),H=m("el-button"),B=m("el-dialog");return g(),x("div",q,[t(B,{title:"工时填报:"+y.value,modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=o=>p.value=o),style:{width:"35%",margin:"0 auto"},"before-close":w,"close-on-click-modal":!1},{default:u(()=>[t($,{model:c.value,"status-icon":"",rules:E.value,style:{"max-height":"75vh","overflow-y":"scroll"}},{default:u(()=>[t(F,{label:"项目工时","label-position":"top"},{default:u(()=>[(g(!0),x(J,null,P(i.value,o=>(g(),x("div",{key:o.projectId,class:"project-item"},[t(j,{class:"box-card",shadow:"never",style:{width:"100%","margin-bottom":"20px"}},{header:u(()=>[a("span",G," #"+b(o.projectId)+" "+b(o.projectName),1)]),default:u(()=>[a("div",K,[t(V,{modelValue:o.hour,"onUpdate:modelValue":h=>o.hour=h,modelModifiers:{number:!0},type:"number",max:24,min:0,maxlength:"2",autocomplete:"off",style:{width:"40%"},precision:2},null,8,["modelValue","onUpdate:modelValue"]),e[4]||(e[4]=a("span",{style:{"margin-left":"10px"}},"小时",-1))]),e[5]||(e[5]=a("hr",null,null,-1)),t(_,{style:{"margin-top":"5px"},modelValue:o.daily,"onUpdate:modelValue":h=>o.daily=h,type:"textarea",maxlength:"200",autosize:{minRows:2,maxRows:6},"show-word-limit":"",placeholder:"请填写日志"},null,8,["modelValue","onUpdate:modelValue"])]),_:2,__:[5]},1024)]))),128))]),_:1}),t(F,{label:"普通工时","label-position":"top"},{default:u(()=>[t(j,{class:"box-card",shadow:"never",style:{width:"100%"}},{default:u(()=>[a("div",O,[t(V,{modelValue:s.value.hour,"onUpdate:modelValue":e[0]||(e[0]=o=>s.value.hour=o),modelModifiers:{number:!0},type:"number",max:24,min:0,maxlength:"2",autocomplete:"off",style:{width:"40%"},precision:2},null,8,["modelValue"]),e[6]||(e[6]=a("span",{style:{"margin-left":"10px"}},"小时",-1))]),e[7]||(e[7]=a("hr",null,null,-1)),t(_,{style:{"margin-top":"5px"},modelValue:s.value.daily,"onUpdate:modelValue":e[1]||(e[1]=o=>s.value.daily=o),type:"textarea",maxlength:"200",autosize:{minRows:2,maxRows:6},"show-word-limit":"",placeholder:"请填写日志"},null,8,["modelValue"])]),_:1,__:[7]})]),_:1})]),_:1},8,["model","rules"]),a("div",Q,[a("div",W,[a("span",X,b(d.value),1),t(_,{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=o=>v.value=o),modelModifiers:{number:!0},max:24,autocomplete:"off",disabled:!0,style:{width:"20%"}},null,8,["modelValue"]),e[10]||(e[10]=a("span",{style:{margin:"0 10px"}},"小时",-1)),a("div",Y,[t(H,{onClick:w,style:{width:"100px"}},{default:u(()=>e[8]||(e[8]=[N(" 取 消 ")])),_:1,__:[8]}),t(H,{disabled:n.value,type:"primary",onClick:R,style:{width:"100px"}},{default:u(()=>e[9]||(e[9]=[N(" 提交 ")])),_:1,__:[9]},8,["disabled"])])])])]),_:1},8,["title","modelValue"])])}}},ae=A(Z,[["__scopeId","data-v-d59b8edb"]]);export{ae as default};
