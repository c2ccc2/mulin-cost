import{d as O,i as P}from"./day-BW9qJLif.js";import{l as U}from"./projectHour-DaHsWXCm.js";import{i as q}from"./other-DCksgyzN.js";import A from"./editHour-BIAEWHWj.js";import{d as F}from"./dayReviewList-BjF4Dn5J.js";import{_ as G,e as J,r as y,b as K,f as r,c as m,o as u,h as e,j as t,p as i,t as c,m as o,i as C,k as M,l as Q,I as X}from"./index-DOTrAPYh.js";import"./project-CvO5xYQd.js";const Y={class:"main"},Z={key:0},ee={key:1},te={key:0},oe={key:1},le={key:2},ae={key:3},ne={key:2},se={class:"button-wrapper"},re={__name:"infoHour",emits:["commit"],setup(ie,{expose:V,emit:B}){const{proxy:d}=J(),$=B,w=y(!1),_=y(void 0),l=y({}),k=y([]),p=y({}),H=y(null),R=K(()=>l.value.reviewType==1&&l.value.reviewStatus==1),E=async a=>{if(!a||!a.id){d.$modal.msgError("参数错误");return}_.value=a.id,w.value=!0,await T(a.id)},T=async a=>{try{const n=await P(a);n.code===200&&(l.value=n.data);const s=await U(a);s.code===200&&(k.value=s.data||[]);const v=await q(a);v.code===200&&(p.value=v.data||{})}catch(n){console.error("获取工时详情失败:",n),d.$modal.msgError("获取工时详情失败")}},b=()=>{w.value=!1,_.value=void 0,l.value={},k.value=[],p.value={}},S=()=>{if(R.value){d.$modal.msgWarning("审核通过的记录无法修改");return}H.value&&H.value.show(_.value),b()},j=()=>{_.value&&T(_.value),$("commit")},D=async()=>{if(R.value){d.$modal.msgWarning("审核通过的记录无法删除");return}d.$modal.confirm("确定要删除该工时记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const a=await O(_.value);a.code===200?(d.$modal.msgSuccess("删除成功"),b(),$("commit")):d.$modal.msgError(a.msg||"删除失败")}catch(a){d.$modal.msgError("删除失败: "+a.message)}}).catch(()=>{d.$modal.msg("已取消删除")})};return V({show:E}),(a,n)=>{const s=r("el-descriptions-item"),v=r("el-descriptions"),h=r("el-form-item"),g=r("el-table-column"),N=r("el-table"),x=r("el-button"),I=r("el-form"),z=r("el-col"),W=r("el-row"),L=r("el-dialog");return u(),m("div",Y,[e(L,{title:"日报详情",modelValue:o(w),"onUpdate:modelValue":n[0]||(n[0]=f=>X(w)?w.value=f:null),style:{width:"42%",margin:"0 auto"},"before-close":b,"custom-class":"detailDialog"},{default:t(()=>[e(W,null,{default:t(()=>[e(z,{span:24},{default:t(()=>[e(I,{ref:"form","label-width":"80px"},{default:t(()=>[e(h,{label:"信息","label-position":"top"},{default:t(()=>[e(v,{column:2,border:"",style:{width:"100%"}},{default:t(()=>[e(s,{label:"填报日期"},{default:t(()=>[i(c(o(l).fillDate),1)]),_:1}),e(s,{label:"提交时间"},{default:t(()=>[i(c(o(l).createTime),1)]),_:1}),e(s,{label:"工时总计"},{default:t(()=>[i(c(o(l).totalHour?o(l).totalHour:0)+"小时",1)]),_:1}),e(s,{label:"审核状态"},{default:t(()=>[o(l).reviewType==0?(u(),m("span",Z,"无需审核")):o(l).reviewType==1?(u(),m("span",ee,[o(l).reviewStatus==0?(u(),m("span",te,"待审核")):o(l).reviewStatus==1?(u(),m("span",oe,"审核通过")):o(l).reviewStatus==-1?(u(),m("span",le,"已驳回")):(u(),m("span",ae,"未知状态"))])):(u(),m("span",ne,"未知"))]),_:1}),e(s,{label:"项目工时"},{default:t(()=>[i(c(o(l).workHour?o(l).workHour:0)+"小时",1)]),_:1}),e(s,{label:"普通工时"},{default:t(()=>[i(c(o(l).otherHour?o(l).otherHour:0)+"小时",1)]),_:1})]),_:1})]),_:1}),e(h,{label:"项目工时","label-position":"top"},{default:t(()=>[e(N,{data:o(k),style:{width:"100%"}},{default:t(()=>[e(g,{type:"index",label:"序号",width:"50",align:"center"}),e(g,{prop:"projectName",label:"项目名称",width:"260"}),e(g,{prop:"hour",label:"工时",width:"80 ",align:"center"},{default:t(f=>[C("span",null,c(f.row.hour)+"小时",1)]),_:1}),e(g,{prop:"daily",label:"工作内容",align:"center"},{default:t(f=>[C("span",null,c(f.row.daily?f.row.daily:"无"),1)]),_:1})]),_:1},8,["data"])]),_:1}),e(h,{label:"普通工时","label-position":"top"},{default:t(()=>[e(v,{column:2,border:"",style:{width:"100%"}},{default:t(()=>[e(s,{label:"工时"},{default:t(()=>[i(c(o(p).hour?o(p).hour:0)+"小时",1)]),_:1}),e(s,{label:"工作内容"},{default:t(()=>[i(c(o(p).daily?o(p).daily:"无"),1)]),_:1})]),_:1})]),_:1}),e(h,{style:{"margin-left":"-80px",width:"calc(100% + 80px)"}},{default:t(()=>[o(l).reviewType==1?(u(),M(F,{key:0,id:o(_)},null,8,["id"])):Q("",!0)]),_:1}),e(h,null,{default:t(()=>[C("div",se,[e(x,{onClick:b,size:"small",style:{width:"120px"}},{default:t(()=>n[1]||(n[1]=[i("关闭")])),_:1,__:[1]}),e(x,{onClick:S,type:"primary",size:"small",style:{width:"120px"}},{default:t(()=>n[2]||(n[2]=[i("修改")])),_:1,__:[2]}),e(x,{onClick:D,type:"danger",size:"small",style:{width:"120px"}},{default:t(()=>n[3]||(n[3]=[i("删除")])),_:1,__:[3]})])]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(o(A),{ref_key:"editHourRef",ref:H,onCommit:j},null,512)])}}},ye=G(re,[["__scopeId","data-v-b39f837e"]]);export{ye as default};
