import{i as F}from"./day-BW9qJLif.js";import{l as G}from"./projectHour-DaHsWXCm.js";import{i as J}from"./other-DCksgyzN.js";import{d as K}from"./dayReviewList-BjF4Dn5J.js";import{_ as M,e as Q,r as c,f as o,c as m,l as C,o as d,h as e,i as x,j as l,p as i,t as _,k as S}from"./index-DOTrAPYh.js";const W={key:0,class:"main"},X={key:0},Y={key:1},Z={key:0},ee={key:1},le={key:2},te={key:3},ae={key:2},oe={align:"center",style:{"margin-top":"20px"}},se={class:"button-wrapper"},ne={__name:"detail",emits:["submit-review","close-dialog"],setup(re,{expose:E,emit:j}){const B=j,{proxy:v}=Q(),V=c(!1),b=c(void 0),a=c({}),H=c([]),f=c({}),w=c(!1),s=c({id:void 0,resultId:1,remark:""}),D=async n=>{if(!n||!n.id){v.$modal.msgError("参数错误");return}b.value=n.id,V.value=!0,await N(n.id)},N=async n=>{try{const t=await F(n);t.code===200&&(a.value=t.data);const r=await G(n);r.code===200&&(H.value=r.data||[]);const y=await J(n);y.code===200&&(f.value=y.data||{})}catch(t){console.error("获取工时详情失败:",t),v.$modal.msgError("获取工时详情失败")}},R=()=>{s.value.id=b.value,s.value.resultId=1,s.value.remark="",w.value=!0},h=()=>{w.value=!1,s.value={id:void 0,resultId:1,remark:""}},T=async n=>{if(!s.value.remark&&s.value.resultId===-1){v.$modal.msgError("驳回时请填写原因");return}try{const t=await n(s.value);t.code===200?(v.$modal.msgSuccess("审核提交成功"),h()):v.$modal.msgError(t.msg||"审核提交失败")}catch(t){console.error("审核提交失败:",t),v.$modal.msgError("审核提交失败: "+t.message)}},z=()=>{V.value=!1,w.value=!1,b.value=void 0,a.value={},H.value=[],f.value={},B("close-dialog")};return E({show:D,handleReview:R,handleReviewClose:h,handleSubmitReview:T}),(n,t)=>{const r=o("el-descriptions-item"),y=o("el-descriptions"),p=o("el-form-item"),g=o("el-table-column"),U=o("el-table"),I=o("el-form"),L=o("el-col"),O=o("el-row"),k=o("el-button"),$=o("el-option"),P=o("el-select"),q=o("el-input"),A=o("el-dialog");return V.value?(d(),m("div",W,[e(O,null,{default:l(()=>[e(L,{span:24},{default:l(()=>[e(I,{ref:"form","label-width":"80px"},{default:l(()=>[e(p,{label:"信息","label-position":"top"},{default:l(()=>[e(y,{column:2,border:"",style:{width:"100%"}},{default:l(()=>[e(r,{label:"填报日期"},{default:l(()=>[i(_(a.value.fillDate),1)]),_:1}),e(r,{label:"提交时间"},{default:l(()=>[i(_(a.value.createTime),1)]),_:1}),e(r,{label:"工时总计"},{default:l(()=>[i(_(a.value.totalHour?a.value.totalHour:0)+"小时 ",1)]),_:1}),e(r,{label:"审核状态"},{default:l(()=>[a.value.reviewType==0?(d(),m("span",X,"无需审核")):a.value.reviewType==1?(d(),m("span",Y,[a.value.reviewStatus==0?(d(),m("span",Z,"待审核")):a.value.reviewStatus==1?(d(),m("span",ee,"审核通过")):a.value.reviewStatus==-1?(d(),m("span",le,"已驳回")):(d(),m("span",te,"未知状态"))])):(d(),m("span",ae,"未知"))]),_:1}),e(r,{label:"项目工时"},{default:l(()=>[i(_(a.value.workHour?a.value.workHour:0)+"小时 ",1)]),_:1}),e(r,{label:"普通工时"},{default:l(()=>[i(_(a.value.otherHour?a.value.otherHour:0)+"小时 ",1)]),_:1})]),_:1})]),_:1}),e(p,{label:"项目工时","label-position":"top"},{default:l(()=>[e(U,{data:H.value,style:{width:"100%"}},{default:l(()=>[e(g,{type:"index",label:"序号",width:"50",align:"center"}),e(g,{prop:"projectName",label:"项目名称",width:"260"}),e(g,{prop:"hour",label:"工时",width:"80",align:"center"},{default:l(u=>[x("span",null,_(u.row.hour)+"小时",1)]),_:1}),e(g,{prop:"daily",label:"工作内容",align:"center"},{default:l(u=>[x("span",null,_(u.row.daily?u.row.daily:"无"),1)]),_:1})]),_:1},8,["data"])]),_:1}),e(p,{label:"普通工时","label-position":"top"},{default:l(()=>[e(y,{column:2,border:"",style:{width:"100%"}},{default:l(()=>[e(r,{label:"工时"},{default:l(()=>[i(_(f.value.hour?f.value.hour:0)+"小时 ",1)]),_:1}),e(r,{label:"工作内容"},{default:l(()=>[i(_(f.value.daily?f.value.daily:"无"),1)]),_:1})]),_:1})]),_:1}),e(p,{style:{"margin-left":"-80px",width:"calc(100% + 80px)"}},{default:l(()=>[a.value.reviewType==1?(d(),S(K,{key:0,id:b.value},null,8,["id"])):C("",!0)]),_:1})]),_:1},512)]),_:1})]),_:1}),x("div",oe,[e(k,{onClick:z,size:"small",style:{width:"120px"}},{default:l(()=>t[4]||(t[4]=[i(" 关闭 ")])),_:1,__:[4]}),a.value.reviewStatus==0?(d(),S(k,{key:0,onClick:R,type:"primary",size:"small",style:{width:"120px"}},{default:l(()=>t[5]||(t[5]=[i(" 审核 ")])),_:1,__:[5]})):C("",!0)]),e(A,{title:"审核",modelValue:w.value,"onUpdate:modelValue":t[3]||(t[3]=u=>w.value=u),width:"30%","before-close":h,"append-to-body":""},{default:l(()=>[e(I,{ref:"form"},{default:l(()=>[e(p,null,{default:l(()=>[e(P,{modelValue:s.value.resultId,"onUpdate:modelValue":t[0]||(t[0]=u=>s.value.resultId=u),placeholder:"审批结果",style:{"margin-left":"1px"}},{default:l(()=>[e($,{label:"通过",value:1}),e($,{label:"驳回",value:-1})]),_:1},8,["modelValue"])]),_:1}),e(p,null,{default:l(()=>[e(q,{style:{"margin-top":"5px"},modelValue:s.value.remark,"onUpdate:modelValue":t[1]||(t[1]=u=>s.value.remark=u),type:"textarea",maxlength:"50",autosize:{minRows:2,maxRows:6},"show-word-limit":"",placeholder:"原因"},null,8,["modelValue"])]),_:1}),e(p,null,{default:l(()=>[x("div",se,[e(k,{onClick:h,style:{width:"120px"}},{default:l(()=>t[6]||(t[6]=[i(" 关闭 ")])),_:1,__:[6]}),e(k,{onClick:t[2]||(t[2]=u=>n.$emit("submit-review",s.value)),type:"primary",style:{width:"120px"}},{default:l(()=>t[7]||(t[7]=[i(" 提交 ")])),_:1,__:[7]})])]),_:1})]),_:1},512)]),_:1},8,["modelValue"])])):C("",!0)}}},pe=M(ne,[["__scopeId","data-v-2bd67455"]]);export{pe as default};
