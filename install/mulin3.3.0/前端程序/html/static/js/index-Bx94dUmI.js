import{_ as X,e as Y,r as m,B as Z,f as i,K as ee,c as le,o as f,h as l,D as k,j as a,n as q,i as I,p as u,t as h,k as g,l as R,G as te}from"./index-DOTrAPYh.js";import{l as ae,s as F}from"./dayReviewList-BjF4Dn5J.js";import oe from"./detail-DTYYKm1n.js";import"./day-BW9qJLif.js";import"./projectHour-DaHsWXCm.js";import"./other-DCksgyzN.js";const ne={class:"app-container"},re={class:"btns"},ue={align:"center"},ie={__name:"index",setup(se){const{proxy:d}=Y(),x=m(null),n=m({fillDate:"",userName:"",nickName:"",reviewStatus:"",pageNum:1,pageSize:10}),z=m([]),V=m(0),c=m(!1),y=m(!1),r=m({resultId:1,remark:"",hourId:void 0}),U=m(0),E=m(void 0),_=async()=>{console.log("开始查询列表");try{const o=await ae(n.value);o.code===200&&(z.value=o.rows||[],V.value=o.total||0,console.log("查询列表成功"),console.log(o))}catch(o){console.error("获取审核列表失败:",o),d.$modal.msgError("获取审核列表失败")}},S=()=>{n.value.pageNum=1,_()},M=()=>{d.$refs.queryForm.resetFields(),n.value.pageNum=1,_()},T=(o,e,b)=>{r.value.id=o.id,r.value.resultId=e,r.index=b,r.value.remark="",c.value=!0},Q=(o,e,b)=>{r.value.id=o.id,r.value.resultId=e,r.value.remark="",c.value=!0},G=(o,e)=>{E.value=o.id,U.value=o.reviewStatus,y.value=!0,setTimeout(()=>{x.value&&x.value.show({id:o.id,...o})},100)},C=()=>{c.value=!1,r.value={resultId:1,remark:"",hourId:void 0}},B=()=>{y.value=!1,E.value=void 0,U.value=0},L=o=>{A(o)},A=async o=>{try{const e=await F(o);e.code===200?(d.$modal.msgSuccess("审核提交成功"),y.value=!1,_()):d.$modal.msgError(e.msg||"审核提交失败")}catch(e){console.error("审核提交失败:",e),d.$modal.msgError("审核提交失败: "+e.message)}},J=async()=>{if(!r.value.remark&&r.value.resultId===-1){d.$modal.msgError("驳回时请填写原因");return}try{const o=await F(r.value);o.code===200?(d.$modal.msgSuccess("审核提交成功"),C(),_()):d.$modal.msgError(o.msg||"审核提交失败")}catch(o){console.error("审核提交失败:",o),d.$modal.msgError("审核提交失败: "+o.message)}};return Z(()=>{_()}),(o,e)=>{const b=i("el-date-picker"),p=i("el-form-item"),N=i("el-input"),w=i("el-option"),P=i("el-select"),v=i("el-button"),H=i("el-form"),s=i("el-table-column"),$=i("el-tag"),O=i("el-table"),W=i("pagination"),K=i("el-dialog"),D=ee("hasPermi");return f(),le("div",ne,[l(H,{model:n.value,ref:"queryForm",size:"small",inline:!0,"label-width":"68px"},{default:a(()=>[l(p,{label:"",prop:"projectName"},{default:a(()=>[l(b,{modelValue:n.value.fillDate,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value.fillDate=t),type:"date","value-format":"yyyy-MM-dd",placeholder:"选择日期",editable:!1,style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(p,null,{default:a(()=>[l(N,{modelValue:n.value.userName,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.userName=t),placeholder:"请输入用户名",clearable:"",style:{width:"200px","margin-left":"10px"},onKeyup:q(S,["enter","native"])},null,8,["modelValue"])]),_:1}),l(p,null,{default:a(()=>[l(N,{modelValue:n.value.nickName,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.nickName=t),placeholder:"请输入姓名",clearable:"",style:{width:"200px","margin-left":"10px"},onKeyup:q(S,["enter","native"])},null,8,["modelValue"])]),_:1}),l(p,null,{default:a(()=>[l(P,{modelValue:n.value.reviewStatus,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.reviewStatus=t),placeholder:"状态",clearable:"",style:{width:"240px"}},{default:a(()=>[l(w,{label:"待审核",value:"0"}),l(w,{label:"已通过",value:"1"}),l(w,{label:"已驳回",value:"-1"}),l(w,{label:"全部",value:""})]),_:1},8,["modelValue"])]),_:1}),l(p,null,{default:a(()=>[I("span",re,[l(v,{onClick:S},{default:a(()=>e[11]||(e[11]=[u("查询")])),_:1,__:[11]}),l(v,{icon:"el-icon-refresh",size:"small",onClick:M},{default:a(()=>e[12]||(e[12]=[u(" 重置 ")])),_:1,__:[12]})])]),_:1})]),_:1},8,["model"]),l(O,{data:z.value,style:{width:"100%"},border:""},{default:a(()=>[l(s,{type:"index",label:"序号",width:"60",align:"center"}),l(s,{prop:"fillDate",label:"日期",align:"center",width:"100"}),l(s,{prop:"hour",label:"总填报",align:"center"},{default:a(t=>[u(h(t.row.totalHour)+" 小时 ",1)]),_:1}),l(s,{prop:"hour",label:"项目工时",align:"center"},{default:a(t=>[u(h(t.row.workHour)+" 小时 ",1)]),_:1}),l(s,{prop:"hour",label:"普通工时",align:"center"},{default:a(t=>[u(h(t.row.otherHour)+" 小时 ",1)]),_:1}),l(s,{prop:"reviewStatus",label:"审核状态",width:"100",align:"center"},{default:a(t=>[I("div",null,[t.row.reviewStatus=="0"?(f(),g($,{key:0},{default:a(()=>e[13]||(e[13]=[u(" 待审核 ")])),_:1,__:[13]})):t.row.reviewStatus=="1"?(f(),g($,{key:1,type:"success"},{default:a(()=>e[14]||(e[14]=[u(" 已通过 ")])),_:1,__:[14]})):t.row.reviewStatus=="-1"?(f(),g($,{key:2,type:"danger"},{default:a(()=>e[15]||(e[15]=[u(" 已驳回 ")])),_:1,__:[15]})):R("",!0)])]),_:1}),l(s,{prop:"userName",label:"用户名",align:"center"}),l(s,{prop:"nickName",label:"姓名",align:"center"}),l(s,{prop:"createTime",label:"填报时间",align:"center",width:"162"}),l(s,{label:"操作",align:"center",width:"230"},{default:a(t=>[t.row.reviewStatus==0?k((f(),g(v,{key:0,onClick:j=>T(t.row,1,t.$index),size:"small"},{default:a(()=>e[16]||(e[16]=[u(" 通过 ")])),_:2,__:[16]},1032,["onClick"])),[[D,["mh:day:review"]]]):R("",!0),t.row.reviewStatus==0?k((f(),g(v,{key:1,onClick:j=>Q(t.row,-1,t.$index),size:"small"},{default:a(()=>e[17]||(e[17]=[u(" 驳回 ")])),_:2,__:[17]},1032,["onClick"])),[[D,["mh:day:review"]]]):R("",!0),l(v,{onClick:j=>G(t.row,t.$index),size:"small"},{default:a(()=>e[18]||(e[18]=[u(" 详情 ")])),_:2,__:[18]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),k(l(W,{total:V.value,page:n.value.pageNum,"onUpdate:page":e[4]||(e[4]=t=>n.value.pageNum=t),limit:n.value.pageSize,"onUpdate:limit":e[5]||(e[5]=t=>n.value.pageSize=t),onPagination:_},null,8,["total","page","limit"]),[[te,V.value>0]]),l(K,{title:"审核",modelValue:c.value,"onUpdate:modelValue":e[9]||(e[9]=t=>c.value=t),width:"30%","before-close":C},{default:a(()=>[l(H,{ref:"form"},{default:a(()=>[l(p,null,{default:a(()=>[l(P,{modelValue:r.value.resultId,"onUpdate:modelValue":e[6]||(e[6]=t=>r.value.resultId=t),placeholder:"审批结果",style:{"margin-left":"1px"},onChange:e[7]||(e[7]=t=>o.$forceUpdate())},{default:a(()=>[l(w,{label:"通过",value:1}),l(w,{label:"驳回",value:-1})]),_:1},8,["modelValue"])]),_:1}),l(p,null,{default:a(()=>[l(N,{style:{"margin-top":"5px"},modelValue:r.value.remark,"onUpdate:modelValue":e[8]||(e[8]=t=>r.value.remark=t),type:"textarea",maxlength:"50",autosize:{minRows:2,maxRows:6},"show-word-limit":"",placeholder:"原因"},null,8,["modelValue"])]),_:1}),l(p,null,{default:a(()=>[I("div",ue,[l(v,{onClick:C,size:"small",style:{width:"120px"}},{default:a(()=>e[19]||(e[19]=[u(" 关闭 ")])),_:1,__:[19]}),k((f(),g(v,{onClick:J,type:"primary",size:"small",style:{width:"120px"}},{default:a(()=>e[20]||(e[20]=[u(" 提交 ")])),_:1,__:[20]})),[[D,["dayHour:review:set"]]])])]),_:1})]),_:1},512)]),_:1},8,["modelValue"]),l(K,{title:"详情",modelValue:y.value,"onUpdate:modelValue":e[10]||(e[10]=t=>y.value=t),"destroy-on-close":"","before-close":B},{default:a(()=>[l(oe,{ref_key:"reviewDetailRef",ref:x,onSubmitReview:L,onCloseDialog:B},null,512)]),_:1},8,["modelValue"])])}}},we=X(ie,[["__scopeId","data-v-45e1824b"]]);export{we as default};
