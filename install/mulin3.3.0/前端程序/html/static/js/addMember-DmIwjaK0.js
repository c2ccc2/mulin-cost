import{l as x,a as B}from"./projectUser-D62y_OJi.js";import{l as L}from"./user-CyO_SREy.js";import{_ as S,B as M,r as p,w,f,K as z,k as h,o as y,j as d,D as P,h as t,i as T,p as I,t as q}from"./index-DOTrAPYh.js";const A={class:"dialog-footer"},K={__name:"addMember",props:{visible:{type:Boolean,default:!1},projectId:{type:String,required:!0}},emits:["success","close"],setup(j,{emit:C}){const r=j;console.log("addMember 组件初始化"),M(()=>{g()});const v=C,s=p(!1),_=p([]),n=p(""),o=p([]),c=p(!1);w(()=>r.visible,e=>{s.value=e,e&&(n.value="",o.value=[],g())}),w(s,e=>{e||v("close")});const g=async()=>{if(console.log("获取用户列表...",r.projectId),s.value=!0,!!r.projectId)try{c.value=!0;const e=await L({pageSize:1e3});if(e.code===200){const l=await x(r.projectId);let a=[];l.code===200&&(a=(l.rows||l.data||[]).map(u=>u.userId)),_.value=(e.rows||e.data||[]).filter(u=>!a.includes(u.userId))}}catch(e){console.error("获取用户列表失败:",e)}finally{c.value=!1}},k=e=>{console.log("选择变化，当前选中:",e),o.value=e.map(l=>l.userId),console.log("选中的用户ID:",o.value)},U=async()=>{if(!r.projectId){console.error("项目ID不能为空");return}if(o.value.length===0){console.warn("请选择要添加的用户");return}console.log("准备添加用户:",o.value);try{c.value=!0;const e=await B({projectId:r.projectId,users:o.value});e.code===200?(console.log("用户批量添加成功"),v("success"),s.value=!1):console.error("批量添加用户失败:",e.msg||"未知错误")}catch(e){console.error("添加人员失败:",e)}finally{c.value=!1}},m=()=>{s.value=!1};return(e,l)=>{const a=f("el-table-column"),u=f("el-input"),V=f("el-table"),b=f("el-button"),D=f("el-dialog"),N=z("loading");return y(),h(D,{modelValue:s.value,"onUpdate:modelValue":l[1]||(l[1]=i=>s.value=i),title:"添加人员",onClose:m,"append-to-body":"","before-close":m,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:d(()=>[T("span",A,[t(b,{onClick:m},{default:d(()=>l[2]||(l[2]=[I("取 消")])),_:1,__:[2]}),t(b,{type:"primary",onClick:U,loading:c.value,disabled:o.value.length===0},{default:d(()=>[I(" 确认添加 ("+q(o.value.length)+") ",1)]),_:1},8,["loading","disabled"])])]),default:d(()=>[P((y(),h(V,{data:_.value.filter(i=>!n.value||i.nickName.toLowerCase().includes(n.value.toLowerCase())||i.userName.toLowerCase().includes(n.value.toLowerCase())),style:{width:"100%"},onSelectionChange:k,"row-key":"userId",ref:"multipleTable"},{default:d(()=>[t(a,{type:"index",label:"序号",width:"60",align:"center"}),t(a,{label:"用户名",prop:"userName",align:"center"}),t(a,{label:"姓名",prop:"nickName",align:"center"}),t(a,{label:"邮箱",prop:"email",align:"center"},{header:d(()=>[t(u,{modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=i=>n.value=i),size:"default",clearable:"",placeholder:"输入姓名或用户名搜索"},null,8,["modelValue"])]),_:1}),t(a,{type:"selection",align:"center",width:"60","reserve-selection":""})]),_:1},8,["data"])),[[N,c.value]])]),_:1},8,["modelValue"])}}},G=S(K,[["__scopeId","data-v-c32a9222"]]);export{G as default};
